<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href="c3-0.3.0/c3.css" rel="stylesheet" type="text/css">
	<script src="c3-0.3.0/d3.min.js" charset="utf-8"></script>
	<script src="c3-0.3.0/c3.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>

<body onload='init()'>

	<div id="main">
		<div id="poster">
			<img id="imagePoster">
		</div>
		<div id="center">
            <div id="search">        
                    <input type="text" id="search_term" />
                    <button onclick="search()">Search</button>
            </div>
            <div class="textSection" id="movie_info">
                <h3 id="title">Title: </h3>
                <p id="tagline"></p>
                <p id="overview">Description: </p>
                <p id="genres">Genres: </p>
                <p id="vote_average">Vote average: </p>
                <p id="runtime"></p>
                <p id="homepage">Homepage: </p>
                <p id="imdb"></p>
            </div>
        </div>
        <div class="textSection" id="twitter_stream">
         <div class="tweet">
            <p class="tweet_title">@jadajada...</p>
            <p class="tweet_txt">Tweet...</p>
        </div>

    </div>
    <div class="diagram" id="diagram1">
        <div id="chart1"></div>
        <div id="chart3"></div>
        <div id="chart2"></div>
    </div>

</div>

<script type="text/javascript">
var movieJSON;
var id = "157336";
var keys;

function updatePage() {
    $("#title").text(movieJSON.title);
    $("#tagline").text(movieJSON.tagline);
    $("#overview").text(movieJSON.overview);
    $("#vote_average").text("Average vote: " + movieJSON.vote_average);
    $("#runtime").text("Runtime: " + movieJSON.runtime + " min");
    $("#homepage").html('<a href="' + movieJSON.homepage + '">' + movieJSON.homepage + '</a>');
    $("#imdb").html('<a href="http://www.imdb.com/title/' + movieJSON.imdb_id + '">IMDb</a>');
    $("#imagePoster").attr("src", "https://image.tmdb.org/t/p/w500" + movieJSON.poster_path);
    $("body").css('background-image', 'url(' + 'https://image.tmdb.org/t/p/w780' + movieJSON.backdrop_path +')');
    var jsonArr = [{'Budget':movieJSON.budget, 'Revenue':movieJSON.revenue}];

    chart1.load({    
        json: jsonArr,
        keys: {
            value: ['Budget', 'Revenue']
        },
        columns: [
            ['Opening Weekend', 1000000],
        ],
        colors: {
        Budget: '#ffa500',
        'Opening Weekend': '#468499',
        Revenue: '#0099cc',
        }
        });
}

function search(form) {
    var id = $("#search_term").val();

    $.ajax({
        url: "json.php?id=" + id,
        async: false,
        dataType: 'json',
        success: function(data) {
            movieJSON = data;
        }
    });

    updatePage();

    $.ajax({
        url: "moviekeys.php",
        async: false,
        dataType: 'json',
        success: function(data) {
            keys = data;
        }
    });
}

function init() {
    
    $.ajax({
        url: "json.php?id=" + id,
        async: false,
        dataType: 'json',
        success: function(data) {
            movieJSON = data;
        }
    });

    updatePage();

};

var chart1 = c3.generate({
   bindto: '#chart1',
   size: {
    height: 240,
    width: 240
},
data: {
        columns: [
            ['Budget', 0],
            ['Opening Weekend', 1000000],
            ['Revenue', 0],
        ],
    type : 'donut',
        colors: {
        Budget: '#ffa500',
        'Opening Weekend': '#468499',
        Revenue: '#0099cc',
    },
    onclick: function (d, i) { console.log("onclick", d, i); },
    onmouseover: function (d, i) { console.log("onmouseover", d, i); },
    onmouseout: function (d, i) { console.log("onmouseout", d, i); }
},
donut: {
    title: "Box Office"
},
tooltip: {
    format: {
        value: function (value, id) {
            var format = d3.format('$');
            return format(value);
        }
    }
}
});

var chart2 = c3.generate({
   bindto: '#chart2',
   size: {
    height: 240,
    width: 240
},
data: {
    columns: [
    ['Amazing', 152],
    ['Great', 106],
    ['Good', 96],
    ['Not too bad', 76],
    ['Bad', 60],
    ['Shitty', 50],
    ],
    type : 'pie',
    colors: {
        Amazing: '#009900',
        Great: '#00cc00',
        Good: '#00ff00',
        'Not too bad': '#99ff00',
        Bad: '#990000',
        Shitty: '#663300',
    },
    onclick: function (d, i) { console.log("onclick", d, i); },
    onmouseover: function (d, i) { console.log("onmouseover", d, i); },
    onmouseout: function (d, i) { console.log("onmouseout", d, i); }
},
 padding: {
        top: 20,
    },
donut: {
    title: "Tweets"
},
tooltip: {
    format: {
        value: function (value, id) {
            return value+" tweets";
        }
    }
}
});

d3.select('#chart2 svg').append('text')
    .attr('x', d3.select('#chart2 svg').node().getBoundingClientRect().width / 2)
    .attr('y', 16)
    .attr('text-anchor', 'middle')
    .style('font-size', '1.4em')
    .text('Tweet Analysis');

var chart3 = c3.generate({
   bindto: '#chart3',
   size: {
    height: 220,
    width: 220
},
data: {
    columns: [
    ['This Movie', 52],
    ['Other Movies', 106],
    ],
    type : 'pie',
    colors: {
        'This Movie': '#31698a',
        'Other Movies': '#c0c0c0',
    },
    onclick: function (d, i) { console.log("onclick", d, i); },
    onmouseover: function (d, i) { console.log("onmouseover", d, i); },
    onmouseout: function (d, i) { console.log("onmouseout", d, i); }
},
 padding: {
        top: 20,
    },
donut: {
    title: "Tweets"
},
tooltip: {
    format: {
        value: function (value, id) {
            return value+" tweets";
        }
    }
}
});

d3.select('#chart3 svg').append('text')
    .attr('x', d3.select('#chart3 svg').node().getBoundingClientRect().width / 2)
    .attr('y', 16)
    .attr('text-anchor', 'middle')
    .style('font-size', '1.4em')
    .text('Movie-related tweets this month');

</script>
</body>
</html>
